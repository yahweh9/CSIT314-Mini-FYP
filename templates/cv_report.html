{% extends 'base.html' %}

{% block head %}
<title>CV Report</title>
{% endblock %}

{% block body %}
<div class="report-table-wrapper">
  <h2>{{ user.fullname }}'s Completed Requests Report</h2>
  <p>Total completed: {{ requests|length }}</p>
  <p>Average Rating: {{ avg_rating }} ★</p>
  <table class="cv-report-table" border="1" cellpadding="6">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Service Category</th>
        <th>Location</th>
        <th>Completed On</th>
        <th>Rating</th>
      </tr>
    </thead>

    <tbody>
      {% for req in requests %}
      <tr>
        <td>{{ req.request_id }}</td>
        <td>{{ req.title }}</td>
        <td class="cv-service-type">{{ req.service_type }}</td>
        <td>{{ req.location }}</td>
        <td>{{ req.completed_date.strftime('%d/%m/%Y') }}</td>
        <td>
            {% if req.feedback_rating %}
                <span class="star-rating">
                    {% for i in range(req.feedback_rating) %}
                        ★
                    {% endfor %}
                    {% for i in range(5 - req.feedback_rating) %}
                        ☆
                    {% endfor %}
                </span>
            {% else %}
                No rating
            {% endif %}
        </td>
        
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<button onclick="window.print()" class="print-btn">Download as PDF</button>

{% endblock %}